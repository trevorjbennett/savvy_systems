# SAVVY Package Index Scraper - Nexus Version
# Scrapes from local Nexus mirror instead of Chocolatey API

FROM python:3.11-slim

# Install curl for healthchecks and waiting for Nexus
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Install dependencies
COPY generator/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy scraper script
COPY generator/scraper_nexus.py scraper.py

# Create logs directory
RUN mkdir -p /app/logs

# Set environment variables
ENV GITHUB_OWNER=trevorjbennett
ENV GITHUB_REPO=savvy_systems
ENV OUTPUT_DIR=/app
ENV NEXUS_URL=http://nexus:8081/repository/chocolatey-proxy/

# Run the scraper
CMD ["python", "scraper.py"]
